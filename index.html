<!-- index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4CAF50" />
  <link rel="manifest" href="manifest.json" />
  <title>Statistik App</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f4f4f4;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 600px;
      text-align: center;
    }
    button {
      margin: 10px 0;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #chart_div {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>MenÃ¼</h2>
    <button onclick="zeigeStatistik()">ðŸ“Š Statistik anzeigen</button>
    <button disabled>ðŸ’° Finanz Ãœbersicht</button>
    <button disabled>ðŸ§¾ PayPal Guthaben korrigieren</button>
    <div id="chart_div"></div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registriert'))
        .catch(err => console.error('SW Fehler:', err));
    }

    google.charts.load('current', { packages: ['corechart'] });

    function zeigeStatistik() {
      fetch("https://script.google.com/macros/s/AKfycbwrZFhx_OvudabwMtwst-60okzWh6ucKxGwqAYgD_3Lx5GAgfOg1paHmB9LRlnz5oF-/exec")
        .then(response => response.json())
        .then(data => drawChart(data))
        .catch(err => {
          document.getElementById("chart_div").innerHTML = "Fehler beim Laden der Daten.";
          console.error(err);
        });
    }

    function drawChart(dataArray) {
      if (!dataArray || dataArray.length === 0) {
        document.getElementById("chart_div").innerHTML = "Keine Daten vorhanden.";
        return;
      }

      const data = google.visualization.arrayToDataTable([
        ['Datum', 'Einzelaufrufe', 'Gesamtaufrufe'],
        ...dataArray
      ]);

      const options = {
        title: 'Statistik',
        curveType: 'function',
        legend: { position: 'bottom' },
        height: 400,
        hAxis: { title: 'Datum' },
        vAxis: { title: 'Aufrufe' }
      };

      const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
  </script>
</body>
</html>

<!-- manifest.json -->
{
  "name": "Statistik App",
  "short_name": "Statistik",
  "start_url": "index.html",
  "display": "standalone",
  "background_color": "#f4f4f4",
  "theme_color": "#4CAF50",
  "icons": [
    {
      "src": "https://www.svgrepo.com/show/365833/stats.svg",
      "sizes": "192x192",
      "type": "image/png"
    }
  ]
}

<!-- sw.js -->
self.addEventListener('install', e => {
  e.waitUntil(
    caches.open('statistik-cache-v1').then(cache => {
      return cache.addAll([
        './',
        './index.html',
        './manifest.json'
      ]);
    })
  );
});

self.addEventListener('fetch', e => {
  e.respondWith(
    caches.match(e.request).then(response => response || fetch(e.request))
  );
});
